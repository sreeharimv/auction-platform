<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live Auction View</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta http-equiv="refresh" content="3">
</head>
<body>
  <div class="container" style="max-width: 1400px !important; margin: 20px auto 40px !important; padding: 0 20px !important;">
    <div class="header">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Palace Premier League" class="logo">
      <h1>Palace Premier League</h1>
    </div>
    
    <nav style="margin-top: 20px;">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('players') }}">Players</a>
      <a href="{{ url_for('teams') }}">Teams</a>
      <a href="{{ url_for('results') }}">Live Results</a>
      <a href="{{ url_for('admin') }}">Admin</a>
      <button onclick="location.reload()" class="btn" style="margin-left: auto;">Refresh</button>
    </nav>

    {% if current_player %}
    <div class="grid" style="margin-bottom: 20px; grid-template-columns: 360px 1fr; gap: 20px; align-items: stretch;">
      <!-- Left column: Larger player photo -->
      <div class="card" style="text-align: center; padding: 30px;">
        <div class="label" style="margin-bottom: 20px;">Current Player</div>
        <img src="{{ url_for('static', filename='players/' + (current_player.photo or 'default.png')) }}?t={{ timestamp() }}" alt="{{ current_player.name }}" style="width: 240px; height: 240px; border-radius: 50%; object-fit: cover; border: 4px solid #93c5fd; margin: 0 auto 20px; display: block; box-shadow: 0 8px 32px rgba(147, 197, 253, 0.3);" onerror="this.src='{{ url_for('static', filename='players/default.png') }}'">
        <div class="metric" style="font-size: 32px;">{{ current_player.name }}</div>
        <div style="color: #94a3b8; font-size: 16px;">{{ current_player.role }}</div>
      </div>

      <!-- Right column: Card with two rows + row 3 (eligible teams) -->
      <div class="card" style="padding: 16px; display: flex; flex-direction: column; gap: 16px;">
        <!-- Row 1 -->
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="card">
            <div class="label">Current Bid</div>
            <div class="metric" style="color: #10b981;">â‚¹{{ format_currency(auction_state.current_bid) }}</div>
            <div style="color: #94a3b8;">{{ auction_state.current_team or "No bids yet" }}</div>
          </div>
          <div class="card">
            <div class="label">Base Price</div>
            <div class="metric">â‚¹{{ format_currency(current_player.base_price) }}</div>
          </div>
        </div>

        <!-- Row 2 -->
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="card">
            <div class="label">Status</div>
            <div class="metric" style="font-size: 20px; text-transform: uppercase; 
                 color: {% if auction_state.status == 'going' %}#f59e0b{% elif auction_state.status == 'bidding' %}#10b981{% else %}#94a3b8{% endif %};">
              {{ auction_state.status }}
              {% if auction_state.status == 'going' %}ðŸ”¥{% elif auction_state.status == 'bidding' %}âš¡{% endif %}
            </div>
          </div>
          {% if starting_team %}
          <div class="card">
            <div class="label">Starting Team</div>
            <div class="metric" style="font-size: 20px;">{{ starting_team }}</div>
          </div>
          {% endif %}
        </div>

        <!-- Row 3: Teams who can bid now -->
        {% if team_limits %}
          {% set eligible = team_limits.values()|selectattr('can_bid_now')|list %}
          <div class="card" style="padding: 12px;">
            <h3 style="margin: 0 0 8px;">Teams Who Can Bid Now</h3>
            {% if eligible|length == 0 %}
              <div style="color: #94a3b8;">No teams can place the next bid.</div>
            {% else %}
            <div class="grid" style="margin-top: 8px;">
              {% for team, info in team_limits.items() %}
                {% if info.can_bid_now %}
                <div class="card" style="padding: 12px;">
                  <div class="label">{{ team }}</div>
                  <div class="metric" style="color: {{ '#f59e0b' if info.near_limit else '#10b981' }};">
                    â‚¹{{ format_currency(info.max_valid_bid) }}
                  </div>
                  <div style="color: #94a3b8; font-size: 12px;">
                    Remaining: â‚¹{{ format_currency(info.remaining) }} â€¢ Players: {{ info.players_with_captain }}/{{ CONFIG.teams.max_players }}
                  </div>
                  {% if info.near_limit %}
                    <div style="color: #f59e0b; font-size: 12px; margin-top: 4px;">Only one increment possible</div>
                  {% endif %}
                </div>
                {% endif %}
              {% endfor %}
            </div>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>

    {% if auction_state.status == "going" %}
    <div class="card" style="background: #7f1d1d; border-color: #dc2626; text-align: center;">
      <h2 style="color: #fca5a5; margin: 0;">GOING ONCE! GOING TWICE!</h2>
      <div style="font-size: 24px; color: white; margin-top: 8px;">
        {{ current_player.name }} - â‚¹{{ format_currency(auction_state.current_bid) }} - {{ auction_state.current_team }}
      </div>
    </div>
    {% endif %}

    

    {% else %}
    <div class="card" style="text-align: center;">
      <h2>No Active Auction</h2>
      <p style="color: #94a3b8;">Waiting for next player...</p>
    </div>
    {% endif %}

  </div>
</body>
</html>
